<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Image Gallery — Modal + Lazy Loading</title>
<style>
  :root{--bg:#0b1220; --card:#08101a; --accent:#ff7ab6; --muted:#9aa3b2}
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; background:linear-gradient(180deg,#071227,#071826); color:white;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    padding:28px;
  }
  .wrap{max-width:1100px; margin:0 auto;}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px}
  h1{font-size:20px; margin:0}
  .controls{display:flex; gap:8px; align-items:center}
  input[type="search"]{padding:8px 10px; border-radius:10px; border:0; min-width:160px; background:rgba(255,255,255,0.03); color:inherit}
  .grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap:12px}
  .card{position:relative; overflow:hidden; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); min-height:140px; display:flex; align-items:center; justify-content:center}
  .card img{width:100%; height:100%; object-fit:cover; display:block; transition: transform 0.35s ease; transform-origin:center;}
  .card:hover img{transform:scale(1.05)}
  .caption{position:absolute; left:8px; bottom:8px; background:rgba(0,0,0,0.5); padding:6px 8px; border-radius:8px; font-size:13px;}
  .skeleton{background:linear-gradient(90deg,#0f1724,#0a1724,#0f1724); animation:shimmer 1.2s infinite}
  @keyframes shimmer{0%{background-position:-200%}100%{background-position:200%}}
  /* Modal */
  .modal-backdrop{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(2,6,23,0.7); z-index:60}
  .modal{max-width:90vw; max-height:90vh; border-radius:10px; overflow:hidden; background:black; display:flex; flex-direction:column; align-items:center}
  .modal img{max-width:100%; max-height:80vh; display:block}
  .modal .meta{padding:10px; color:var(--muted); display:flex; gap:10px; align-items:center}
  .modal .close, .modal .nav { background:transparent; border:0; color:white; font-size:20px; cursor:pointer; padding:8px; }
  .modal .nav{ font-size:26px }
  /* Responsive tweaks */
  @media (max-width:520px){
    .grid{grid-template-columns: repeat(2,1fr)}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Image Gallery — Modal & Lazy Loading</h1>
      <div class="controls">
        <input type="search" id="filterBox" placeholder="Filter by tag or author..." aria-label="Filter images" />
      </div>
    </header>

    <main>
      <section class="grid" id="gallery" aria-live="polite"></section>
    </main>
  </div>

  <!-- Modal -->
  <div id="backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <div style="display:flex; align-items:center; gap:8px; padding:8px;">
        <button class="nav" id="prevBtn" aria-label="Previous image">◀</button>
        <button class="nav" id="nextBtn" aria-label="Next image">▶</button>
        <div style="flex:1"></div>
        <button class="close" id="closeBtn" aria-label="Close modal">✕</button>
      </div>
      <div style="display:flex; align-items:center; justify-content:center; width:100%; background:#000">
        <img id="modalImg" alt="" />
      </div>
      <div class="meta" id="modalMeta"></div>
    </div>
  </div>

<script>
(() => {
  // Sample image data: using picsum placeholders. In real app you'd fetch an API.
  const images = Array.from({length:20}, (_,i) => {
    const id = 100 + i;
    const w = 1200, h = 800;
    // Use small thumbnails for grid
    return {
      id: id,
      thumb: https://picsum.photos/id/${id}/600/400,
      src: https://picsum.photos/id/${id}/${w}/${h},
      author: ['Alice','Bob','Charlie','Dana','Eve'][i % 5],
      tags: ['nature','city','people','architecture','abstract'][i % 5],
      title: Photo #${i+1}
    };
  });

  const gallery = document.getElementById('gallery');
  const filterBox = document.getElementById('filterBox');

  // Build grid items with lazy load attributes
  images.forEach((img, idx) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.tabIndex = 0;
    card.dataset.index = idx;
    card.dataset.tags = (img.tags + ' ' + img.author + ' ' + img.title).toLowerCase();
    card.innerHTML = `
      <img data-src="${img.thumb}" alt="${img.title} by ${img.author}" class="skeleton" loading="lazy" />
      <div class="caption">${img.author} • ${img.tags}</div>
    `;
    gallery.appendChild(card);
  });

  // IntersectionObserver for lazy loading
  const io = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        const imgEl = entry.target.querySelector('img');
        if(imgEl && imgEl.dataset.src){
          imgEl.src = imgEl.dataset.src;
          imgEl.onload = () => imgEl.classList.remove('skeleton');
          imgEl.removeAttribute('data-src');
        }
        obs.unobserve(entry.target);
      }
    });
  }, {rootMargin: '120px 0px', threshold: 0.01});

  document.querySelectorAll('.card').forEach(c => io.observe(c));

  // Modal functionality
  const backdrop = document.getElementById('backdrop');
  const modalImg = document.getElementById('modalImg');
  const modalMeta = document.getElementById('modalMeta');
  const closeBtn = document.getElementById('closeBtn');
  const nextBtn = document.getElementById('nextBtn');
  const prevBtn = document.getElementById('prevBtn');

  let currentIndex = 0;

  function openModal(idx){
    currentIndex = idx;
    const data = images[idx];
    // show high-res
    modalImg.src = '';
    modalImg.alt = data.title + ' by ' + data.author;
    backdrop.style.display = 'flex';
    backdrop.setAttribute('aria-hidden','false');
    // Preload
    const pre = new Image();
    pre.onload = () => modalImg.src = pre.src;
    pre.src = data.src;
    modalMeta.textContent = data.title + ' — ' + data.author + ' • ' + data.tags;
    document.body.style.overflow = 'hidden';
  }

  function closeModal(){
    backdrop.style.display = 'none';
    backdrop.setAttribute('aria-hidden','true');
    modalImg.src = '';
    document.body.style.overflow = '';
  }

  function showNext(){
    currentIndex = (currentIndex + 1) % images.length;
    openModal(currentIndex);
  }
  function showPrev(){
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    openModal(currentIndex);
  }

  // Click on card to open modal (event delegation)
  gallery.addEventListener('click', (ev) => {
    const card = ev.target.closest('.card');
    if(!card) return;
    const idx = Number(card.dataset.index);
    openModal(idx);
  });

  // Keyboard navigation + close when backdrop clicked
  closeBtn.addEventListener('click', closeModal);
  nextBtn.addEventListener('click', showNext);
  prevBtn.addEventListener('click', showPrev);
  backdrop.addEventListener('click', (ev) => {
    if(ev.target === backdrop) closeModal();
  });

  document.addEventListener('keydown', (ev) => {
    if(backdrop.style.display === 'flex'){
      if(ev.key === 'Escape') closeModal();
      if(ev.key === 'ArrowRight') showNext();
      if(ev.key === 'ArrowLeft') showPrev();
    }
  });

  // Filter input: simple client-side filter
  let filterTimer = null;
  filterBox.addEventListener('input', (e)=>{
    clearTimeout(filterTimer);
    const val = e.target.value.trim().toLowerCase();
    filterTimer = setTimeout(() => {
      const cards = document.querySelectorAll('.card');
      cards.forEach(c => {
        const tags = c.dataset.tags;
        c.style.display = (!val || tags.includes(val)) ? '' : 'none';
      });
    }, 150);
  });

  // Accessibility: focusable cards support Enter to open
  gallery.addEventListener('keydown', (ev) => {
    if(ev.key === 'Enter'){
      const card = document.activeElement.closest && document.activeElement.closest('.card');
      if(card) {
        openModal(Number(card.dataset.index));
      }
    }
  });

  // Preload a few images for smoother UX
  const preload = [0,1,2].map(i => {
    const img = new Image();
    img.src = images[i].thumb;
  });
})();
</script>
</body>
</html>
